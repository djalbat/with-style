'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.renderStyles = renderStyles;
exports.generateStyle = generateStyle;
exports.retrieveStyle = retrieveStyle;

var _style = _interopRequireDefault(require("../style"));

var _lexer = _interopRequireDefault(require("../css/lexer"));

var _parser = _interopRequireDefault(require("../css/parser"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var cssLexer = _lexer["default"].fromNothing(),
    cssParser = _parser["default"].fromNothing();

var styleMap = {};

function renderStyles() {
  var stylesCSS = retrieveStylesCSS(),
      innerHTML = "\n        \n".concat(stylesCSS),
      headDOMElement = document.querySelector('head'),
      styleDOMElement = document.createElement('style');
  Object.assign(styleDOMElement, {
    innerHTML: innerHTML
  });
  headDOMElement.appendChild(styleDOMElement);
}

function generateStyle(args, className) {
  var superStyle = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

  var strings = args.shift(),
      ///
  content = strings.reduce(function (content, string, index) {
    var arg = args[index];
    content = arg !== undefined ? "".concat(content).concat(string).concat(arg) : "".concat(content).concat(string);
    return content;
  }, ''),
      tokens = cssLexer.tokenise(content),
      node = cssParser.parse(tokens),
      style = _style["default"].fromNodeAndTokens(node, tokens);

  if (superStyle !== null) {
    style["extends"](superStyle);
  }

  styleMap[className] = style;
}

function retrieveStyle(className) {
  var style = styleMap[className] || null;
  return style;
}

module.exports = {
  renderStyles: renderStyles,
  generateStyle: generateStyle,
  retrieveStyle: retrieveStyle
};

function retrieveStylesCSS() {
  var classNames = Object.keys(styleMap),
      stylesCSS = classNames.reduce(function (stylesCSS, className) {
    var style = retrieveStyle(className),
        styleCSS = style.asCSS(className);
    stylesCSS += styleCSS;
    return stylesCSS;
  }, '');
  return stylesCSS;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0eWxlcy5qcyJdLCJuYW1lcyI6WyJjc3NMZXhlciIsIkNTU0xleGVyIiwiZnJvbU5vdGhpbmciLCJjc3NQYXJzZXIiLCJDU1NQYXJzZXIiLCJzdHlsZU1hcCIsInJlbmRlclN0eWxlcyIsInN0eWxlc0NTUyIsInJldHJpZXZlU3R5bGVzQ1NTIiwiaW5uZXJIVE1MIiwiaGVhZERPTUVsZW1lbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzdHlsZURPTUVsZW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiT2JqZWN0IiwiYXNzaWduIiwiYXBwZW5kQ2hpbGQiLCJnZW5lcmF0ZVN0eWxlIiwiYXJncyIsImNsYXNzTmFtZSIsInN1cGVyU3R5bGUiLCJzdHJpbmdzIiwic2hpZnQiLCJjb250ZW50IiwicmVkdWNlIiwic3RyaW5nIiwiaW5kZXgiLCJhcmciLCJ1bmRlZmluZWQiLCJ0b2tlbnMiLCJ0b2tlbmlzZSIsIm5vZGUiLCJwYXJzZSIsInN0eWxlIiwiU3R5bGUiLCJmcm9tTm9kZUFuZFRva2VucyIsInJldHJpZXZlU3R5bGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiY2xhc3NOYW1lcyIsImtleXMiLCJzdHlsZUNTUyIsImFzQ1NTIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7O0FBRUE7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxJQUFNQSxRQUFRLEdBQUdDLGtCQUFTQyxXQUFULEVBQWpCO0FBQUEsSUFDTUMsU0FBUyxHQUFHQyxtQkFBVUYsV0FBVixFQURsQjs7QUFHQSxJQUFNRyxRQUFRLEdBQUcsRUFBakI7O0FBRU8sU0FBU0MsWUFBVCxHQUF3QjtBQUM3QixNQUFNQyxTQUFTLEdBQUdDLGlCQUFpQixFQUFuQztBQUFBLE1BQ01DLFNBQVMseUJBRWZGLFNBRmUsQ0FEZjtBQUFBLE1BSUlHLGNBQWMsR0FBR0MsUUFBUSxDQUFDQyxhQUFULENBQXVCLE1BQXZCLENBSnJCO0FBQUEsTUFLSUMsZUFBZSxHQUFHRixRQUFRLENBQUNHLGFBQVQsQ0FBdUIsT0FBdkIsQ0FMdEI7QUFPQUMsRUFBQUEsTUFBTSxDQUFDQyxNQUFQLENBQWNILGVBQWQsRUFBK0I7QUFDN0JKLElBQUFBLFNBQVMsRUFBVEE7QUFENkIsR0FBL0I7QUFJQUMsRUFBQUEsY0FBYyxDQUFDTyxXQUFmLENBQTJCSixlQUEzQjtBQUNEOztBQUVNLFNBQVNLLGFBQVQsQ0FBdUJDLElBQXZCLEVBQTZCQyxTQUE3QixFQUEyRDtBQUFBLE1BQW5CQyxVQUFtQix1RUFBTixJQUFNOztBQUNoRSxNQUFNQyxPQUFPLEdBQUdILElBQUksQ0FBQ0ksS0FBTCxFQUFoQjtBQUFBLE1BQThCO0FBQ3hCQyxFQUFBQSxPQUFPLEdBQUdGLE9BQU8sQ0FBQ0csTUFBUixDQUFlLFVBQUNELE9BQUQsRUFBVUUsTUFBVixFQUFrQkMsS0FBbEIsRUFBNEI7QUFDbkQsUUFBTUMsR0FBRyxHQUFHVCxJQUFJLENBQUNRLEtBQUQsQ0FBaEI7QUFFQUgsSUFBQUEsT0FBTyxHQUFJSSxHQUFHLEtBQUtDLFNBQVQsYUFDS0wsT0FETCxTQUNlRSxNQURmLFNBQ3dCRSxHQUR4QixjQUVPSixPQUZQLFNBRWlCRSxNQUZqQixDQUFWO0FBSUEsV0FBT0YsT0FBUDtBQUNELEdBUlMsRUFRUCxFQVJPLENBRGhCO0FBQUEsTUFVTU0sTUFBTSxHQUFHOUIsUUFBUSxDQUFDK0IsUUFBVCxDQUFrQlAsT0FBbEIsQ0FWZjtBQUFBLE1BV01RLElBQUksR0FBRzdCLFNBQVMsQ0FBQzhCLEtBQVYsQ0FBZ0JILE1BQWhCLENBWGI7QUFBQSxNQVlNSSxLQUFLLEdBQUdDLGtCQUFNQyxpQkFBTixDQUF3QkosSUFBeEIsRUFBOEJGLE1BQTlCLENBWmQ7O0FBY00sTUFBSVQsVUFBVSxLQUFLLElBQW5CLEVBQXlCO0FBQ3ZCYSxJQUFBQSxLQUFLLFdBQUwsQ0FBY2IsVUFBZDtBQUNEOztBQUVEaEIsRUFBQUEsUUFBUSxDQUFDZSxTQUFELENBQVIsR0FBc0JjLEtBQXRCO0FBQ1A7O0FBRU0sU0FBU0csYUFBVCxDQUF1QmpCLFNBQXZCLEVBQWtDO0FBQ3ZDLE1BQU1jLEtBQUssR0FBRzdCLFFBQVEsQ0FBQ2UsU0FBRCxDQUFSLElBQXVCLElBQXJDO0FBRUEsU0FBT2MsS0FBUDtBQUNEOztBQUVESSxNQUFNLENBQUNDLE9BQVAsR0FBaUI7QUFDZmpDLEVBQUFBLFlBQVksRUFBWkEsWUFEZTtBQUVmWSxFQUFBQSxhQUFhLEVBQWJBLGFBRmU7QUFHZm1CLEVBQUFBLGFBQWEsRUFBYkE7QUFIZSxDQUFqQjs7QUFNQSxTQUFTN0IsaUJBQVQsR0FBNkI7QUFDM0IsTUFBTWdDLFVBQVUsR0FBR3pCLE1BQU0sQ0FBQzBCLElBQVAsQ0FBWXBDLFFBQVosQ0FBbkI7QUFBQSxNQUNNRSxTQUFTLEdBQUdpQyxVQUFVLENBQUNmLE1BQVgsQ0FBa0IsVUFBQ2xCLFNBQUQsRUFBWWEsU0FBWixFQUEwQjtBQUN0RCxRQUFNYyxLQUFLLEdBQUdHLGFBQWEsQ0FBQ2pCLFNBQUQsQ0FBM0I7QUFBQSxRQUNNc0IsUUFBUSxHQUFHUixLQUFLLENBQUNTLEtBQU4sQ0FBWXZCLFNBQVosQ0FEakI7QUFHQWIsSUFBQUEsU0FBUyxJQUFJbUMsUUFBYjtBQUVBLFdBQU9uQyxTQUFQO0FBQ0QsR0FQVyxFQU9ULEVBUFMsQ0FEbEI7QUFVQSxTQUFPQSxTQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCBTdHlsZSBmcm9tICcuLi9zdHlsZSc7XG5pbXBvcnQgQ1NTTGV4ZXIgZnJvbSAnLi4vY3NzL2xleGVyJztcbmltcG9ydCBDU1NQYXJzZXIgZnJvbSAnLi4vY3NzL3BhcnNlcic7XG5cbmNvbnN0IGNzc0xleGVyID0gQ1NTTGV4ZXIuZnJvbU5vdGhpbmcoKSxcbiAgICAgIGNzc1BhcnNlciA9IENTU1BhcnNlci5mcm9tTm90aGluZygpO1xuXG5jb25zdCBzdHlsZU1hcCA9IHt9O1xuXG5leHBvcnQgZnVuY3Rpb24gcmVuZGVyU3R5bGVzKCkge1xuICBjb25zdCBzdHlsZXNDU1MgPSByZXRyaWV2ZVN0eWxlc0NTUygpLFxuICAgICAgICBpbm5lckhUTUwgPSBgXG4gICAgICAgIFxuJHtzdHlsZXNDU1N9YCxcbiAgICAgIGhlYWRET01FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaGVhZCcpLFxuICAgICAgc3R5bGVET01FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcblxuICBPYmplY3QuYXNzaWduKHN0eWxlRE9NRWxlbWVudCwge1xuICAgIGlubmVySFRNTFxuICB9KTtcblxuICBoZWFkRE9NRWxlbWVudC5hcHBlbmRDaGlsZChzdHlsZURPTUVsZW1lbnQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVTdHlsZShhcmdzLCBjbGFzc05hbWUsIHN1cGVyU3R5bGUgPSBudWxsKSB7XG4gIGNvbnN0IHN0cmluZ3MgPSBhcmdzLnNoaWZ0KCksXHQvLy9cbiAgICAgICAgY29udGVudCA9IHN0cmluZ3MucmVkdWNlKChjb250ZW50LCBzdHJpbmcsIGluZGV4KSA9PiB7XG4gICAgICAgICAgY29uc3QgYXJnID0gYXJnc1tpbmRleF07XG5cbiAgICAgICAgICBjb250ZW50ID0gKGFyZyAhPT0gdW5kZWZpbmVkKSA/XG4gICAgICAgICAgICAgICAgICAgICAgYCR7Y29udGVudH0ke3N0cmluZ30ke2FyZ31gIDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGAke2NvbnRlbnR9JHtzdHJpbmd9YDtcblxuICAgICAgICAgIHJldHVybiBjb250ZW50O1xuICAgICAgICB9LCAnJyksXG4gICAgICAgIHRva2VucyA9IGNzc0xleGVyLnRva2VuaXNlKGNvbnRlbnQpLFxuICAgICAgICBub2RlID0gY3NzUGFyc2VyLnBhcnNlKHRva2VucyksXG4gICAgICAgIHN0eWxlID0gU3R5bGUuZnJvbU5vZGVBbmRUb2tlbnMobm9kZSwgdG9rZW5zKTtcblxuICAgICAgICBpZiAoc3VwZXJTdHlsZSAhPT0gbnVsbCkge1xuICAgICAgICAgIHN0eWxlLmV4dGVuZHMoc3VwZXJTdHlsZSk7XG4gICAgICAgIH1cblxuICAgICAgICBzdHlsZU1hcFtjbGFzc05hbWVdID0gc3R5bGU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXRyaWV2ZVN0eWxlKGNsYXNzTmFtZSkge1xuICBjb25zdCBzdHlsZSA9IHN0eWxlTWFwW2NsYXNzTmFtZV0gfHwgbnVsbDtcblxuICByZXR1cm4gc3R5bGU7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICByZW5kZXJTdHlsZXMsXG4gIGdlbmVyYXRlU3R5bGUsXG4gIHJldHJpZXZlU3R5bGVcbn07XG5cbmZ1bmN0aW9uIHJldHJpZXZlU3R5bGVzQ1NTKCkge1xuICBjb25zdCBjbGFzc05hbWVzID0gT2JqZWN0LmtleXMoc3R5bGVNYXApLFxuICAgICAgICBzdHlsZXNDU1MgPSBjbGFzc05hbWVzLnJlZHVjZSgoc3R5bGVzQ1NTLCBjbGFzc05hbWUpID0+IHtcbiAgICAgICAgICBjb25zdCBzdHlsZSA9IHJldHJpZXZlU3R5bGUoY2xhc3NOYW1lKSxcbiAgICAgICAgICAgICAgICBzdHlsZUNTUyA9IHN0eWxlLmFzQ1NTKGNsYXNzTmFtZSk7XG5cbiAgICAgICAgICBzdHlsZXNDU1MgKz0gc3R5bGVDU1M7XG5cbiAgICAgICAgICByZXR1cm4gc3R5bGVzQ1NTO1xuICAgICAgICB9LCAnJyk7XG5cbiAgcmV0dXJuIHN0eWxlc0NTUztcbn1cbiJdfQ==